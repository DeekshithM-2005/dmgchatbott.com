<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chatbot..</title>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

<style>
  :root {
    --bg: radial-gradient(1200px 800px at 10% 10%, #1e2633 0%, #0f1217 45%, #0b0e12 100%),
          radial-gradient(800px 600px at 90% 20%, rgba(0, 213, 255, 0.15), transparent 50%),
          radial-gradient(700px 600px at 80% 90%, rgba(162, 89, 255, 0.15), transparent 60%);
    --panel: rgba(255, 255, 255, 0.08);
    --panel-strong: rgba(255, 255, 255, 0.12);
    --text: #e8eef7;
    --muted: #a0b3c7;
    --accent: #60a5fa;
    --accent-2: #a855f7;
    --success: #22c55e;
    --danger: #ef4444;
    --border: 1px solid rgba(255, 255, 255, 0.18);
    --radius: 16px;
    --radius-lg: 22px;
    --shadow-lg: 0 10px 40px rgba(0,0,0,0.45);
    --shadow-sm: 0 6px 18px rgba(0,0,0,0.25);
    --blur: saturate(160%) blur(14px);
    --glass: linear-gradient(145deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04));
    --bot-bubble: rgba(255,255,255,0.08);
    --user-bubble: linear-gradient(145deg, #2563eb, #7c3aed);
    --timestamp: rgba(255,255,255,0.28);
  }

  @media (prefers-color-scheme: light) {
    :root {
      --bg: linear-gradient(180deg, #f6f9ff, #eef3fb);
      --panel: rgba(255, 255, 255, 0.7);
      --panel-strong: rgba(255, 255, 255, 0.85);
      --text: #0c1424;
      --muted: #425a78;
      --accent: #2563eb;
      --accent-2: #7c3aed;
      --border: 1px solid rgba(11, 15, 19, 0.08);
      --shadow-lg: 0 20px 50px rgba(12, 20, 36, 0.12);
      --shadow-sm: 0 8px 24px rgba(12, 20, 36, 0.10);
      --blur: saturate(140%) blur(8px);
      --glass: linear-gradient(145deg, rgba(255,255,255,0.85), rgba(255,255,255,0.65));
      --bot-bubble: rgba(12, 20, 36, 0.06);
      --user-bubble: linear-gradient(145deg, #2563eb, #7c3aed);
      --timestamp: rgba(12, 20, 36, 0.45);
    }
  }

  * { box-sizing: border-box; }
  html, body { height: 100%; }

  body {
    margin: 0;
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    background: var(--bg);
    color: var(--text);
    line-height: 1.45;
    display: grid;
    place-items: center;
    padding: 24px;
  }

  .wrap {
    width: min(960px, 100%);
    display: grid;
    grid-template-rows: auto 1fr auto auto;
    gap: 14px;
  }

  .brand {
    display: flex;
    align-items: center;
    gap: 12px;
    letter-spacing: 0.2px;
    color: var(--muted);
    font-weight: 500;
    user-select: none;
  }

  .logo {
    width: 36px; height: 36px;
    border-radius: 10px;
    background: conic-gradient(from 0deg, #2563eb, #7c3aed, #06b6d4, #22c55e, #2563eb);
    filter: saturate(140%);
    position: relative;
    box-shadow: 0 6px 24px rgba(124, 58, 237, 0.35);
  }
  .logo::after {
    content: "";
    position: absolute; inset: 2px;
    border-radius: 8px;
    background: var(--glass);
    backdrop-filter: var(--blur);
  }

  .chat-container {
    background: var(--glass);
    border: var(--border);
    box-shadow: var(--shadow-lg);
    border-radius: var(--radius-lg);
    min-height: min(78vh, 760px);
    display: grid;
    grid-template-rows: auto 1fr auto;
    overflow: clip;
    position: relative;
    isolation: isolate;
  }

  .chat-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 14px 16px;
    background: linear-gradient(0deg, transparent, rgba(0,0,0,0.08));
    border-bottom: var(--border);
    backdrop-filter: var(--blur);
  }

  .agent {
    display: flex; align-items: center; gap: 12px;
  }
  .agent .avatar {
    width: 34px; height: 34px; border-radius: 10px;
    background: linear-gradient(145deg, #1f2937, #111827);
    border: 1px solid rgba(255,255,255,0.14);
    display: grid; place-items: center;
    color: #9ca3af;
    font-weight: 600;
    font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  }
  .agent .meta {
    display: grid; gap: 2px;
  }
  .agent .name { font-weight: 600; letter-spacing: 0.2px; }
  .agent .status { font-size: 12px; color: var(--muted); }

  .toolbar {
    display: flex; align-items: center; gap: 8px;
  }
  .pill {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 8px 10px;
    border-radius: 999px;
    border: var(--border);
    background: var(--panel);
    color: var(--muted);
    font-size: 12px;
    backdrop-filter: var(--blur);
  }
  .dot {
    width: 8px; height: 8px; border-radius: 999px; background: var(--success);
    box-shadow: 0 0 0 4px rgba(34,197,94,0.15);
  }

  /* Chat area with ARIA live region for accessibility */
  .chat-box {
    position: relative;
    padding: 18px 16px 22px;
    overflow: auto;
    display: grid; align-content: start; gap: 12px;
  }
  /* Make new messages announced by screen readers */
  .chat-box[role="log"] { }

  .day-divider {
    display: grid; grid-auto-flow: column; align-items: center; gap: 10px;
    color: var(--muted); font-size: 12px; letter-spacing: 0.3px;
  }
  .day-divider::before, .day-divider::after {
    content: ""; height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
  }

  /* Message group */
  .group {
    display: grid; gap: 6px;
    max-width: min(740px, 92%);
  }

  .message {
    --pad-x: 13px;
    --pad-y: 10px;
    padding: var(--pad-y) var(--pad-x);
    border-radius: 14px;
    font-size: 15px;
    letter-spacing: 0.1px;
    word-wrap: break-word;
    white-space: pre-wrap;
    line-height: 1.45;
    border: var(--border);
    backdrop-filter: var(--blur);
    animation: pop 160ms ease-out;
    transform-origin: bottom left;
  }

  .bot-message {
    background: var(--bot-bubble);
    color: var(--text);
    box-shadow: var(--shadow-sm);
  }

  .user-row { display: grid; justify-items: end; }
  .user-message {
    background: var(--user-bubble);
    color: white;
    border: 1px solid rgba(255,255,255,0.18);
    box-shadow: 0 8px 24px rgba(37, 99, 235, 0.3);
    transform-origin: bottom right;
  }

  .meta-line {
    display: flex; align-items: center; gap: 8px;
    font-size: 12px; color: var(--timestamp);
    padding: 0 6px;
  }

  .typing {
    display: inline-flex; gap: 6px; align-items: center;
    padding: 8px 10px;
    border-radius: 999px; background: var(--panel);
    border: var(--border);
    width: fit-content;
  }
  .typing .b {
    width: 6px; height: 6px; border-radius: 999px; background: var(--muted);
    animation: blink 1.2s infinite ease-in-out;
  }
  .typing .b:nth-child(2){ animation-delay: 0.15s; }
  .typing .b:nth-child(3){ animation-delay: 0.3s; }

  @keyframes blink {
    0%, 80%, 100% { opacity: 0.25; transform: translateY(0); }
    40% { opacity: 1; transform: translateY(-2px); }
  }
  @keyframes pop {
    from { opacity: 0; transform: translateY(6px) scale(0.98); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }

  .input-area {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 10px;
    padding: 12px;
    border-top: var(--border);
    background: linear-gradient(180deg, transparent, rgba(0,0,0,0.08));
    backdrop-filter: var(--blur);
  }

  .input-shell {
    display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 8px;
    padding: 10px 12px;
    border-radius: 12px;
    background: var(--panel-strong);
    border: var(--border);
    box-shadow: var(--shadow-sm);
  }

  input[type="text"] {
    background: transparent;
    border: none;
    color: var(--text);
    outline: none;
    font-size: 15px;
    padding: 8px 4px;
  }
  input::placeholder { color: var(--muted); }

  .kbd {
    font-family: "JetBrains Mono", ui-monospace, monospace;
    font-size: 12px;
    color: var(--muted);
    border: var(--border);
    border-bottom-width: 2px;
    padding: 3px 6px;
    border-radius: 8px;
    background: var(--panel);
    backdrop-filter: var(--blur);
  }

  button.send {
    display: inline-flex; align-items: center; gap: 8px;
    border: none; cursor: pointer;
    padding: 10px 14px;
    border-radius: 12px;
    color: white;
    background: linear-gradient(145deg, var(--accent), var(--accent-2));
    box-shadow: 0 10px 24px rgba(96,165,250,0.35);
    transition: transform 120ms ease, filter 120ms ease, box-shadow 120ms ease;
  }
  button.send:hover { transform: translateY(-1px); filter: saturate(120%); }
  button.send:active { transform: translateY(0); box-shadow: 0 6px 18px rgba(96,165,250,0.28); }

  .footer {
    display: flex; justify-content: space-between; align-items: center;
    color: var(--muted);
    font-size: 12px;
    padding: 0 4px;
  }
  .footer .url {
    padding: 6px 10px; border-radius: 8px;
    background: var(--panel); border: var(--border);
    backdrop-filter: var(--blur);
    color: var(--muted);
  }

  /* Scrollbar */
  .chat-box::-webkit-scrollbar { width: 10px; }
  .chat-box::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, rgba(255,255,255,0.25), rgba(255,255,255,0.12));
    border-radius: 999px;
    border: 2px solid transparent;
    background-clip: padding-box;
  }

  /* Responsive */
  @media (max-width: 720px) {
    body { padding: 12px; }
    .wrap { gap: 10px; }
    .chat-container { min-height: 72vh; }
    .input-area { grid-template-columns: 1fr; }
    button.send { width: 100%; justify-content: center; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>Chat AI</div>
    </div>

    <section class="chat-container" aria-label="Chat interface">
      <header class="chat-header">
        <div class="agent">
          <div class="avatar">AI</div>
          <div class="meta">
            <div class="name">Assistant</div>
            <div class="status">Conversational AI</div>
          </div>
        </div>
        <div class="toolbar">
          <div class="pill"><span class="dot"></span> Online</div>
          <div class="pill">Secure</div>
        </div>
      </header>

      <!-- ARIA live region: role=log with aria-live polite for chat updates -->
      <div class="chat-box" id="chat-box" role="log" aria-live="polite" aria-relevant="additions text" aria-atomic="false">
        <div class="day-divider">Today</div>
        <div class="group">
          <div class="message bot-message">
            Hello! This chat uses the Java backend + OpenAI. Type a message below.
          </div>
          <div class="meta-line">Assistant · just now</div>
        </div>
      </div>

      <div class="input-area">
        <div class="input-shell">
          <input id="user-input" type="text" placeholder="Message the assistant…" autocomplete="off" aria-label="Message input" />
          <span class="kbd" aria-hidden="true">Enter ↵</span>
        </div>
        <button class="send" id="send-btn" type="button" aria-label="Send message">
          Send
        </button>
      </div>
    </section>

    <div class="footer">
      <div>Tip: Shift+Enter for newline</div>
      <div class="url">Backend URL: <span id="backend-url">http://localhost:8080/api/chat</span></div>
    </div>
  </div>

<script>
  const API_URL = 'http://localhost:8081/api/chat'; // change when hosting
  const chatBox = document.getElementById('chat-box');
  const userInput = document.getElementById('user-input');
  const sendBtn = document.getElementById('send-btn');

  function addGroupRow(alignment = 'left') {
    const row = document.createElement('div');
    row.className = alignment === 'right' ? 'group user-row' : 'group';
    chatBox.appendChild(row);
    return row;
  }

  function addMeta(text) {
    const meta = document.createElement('div');
    meta.className = 'meta-line';
    meta.textContent = text;
    chatBox.appendChild(meta);
  }

  function displayMessage(text, sender) {
    const group = addGroupRow(sender === 'user' ? 'right' : 'left');
    const bubble = document.createElement('div');
    bubble.className = 'message ' + (sender === 'user' ? 'user-message' : 'bot-message');
    bubble.textContent = text;
    group.appendChild(bubble);

    // Scroll into view and ensure announcement in live region
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function showTyping() {
    const wrap = document.createElement('div');
    wrap.className = 'group';
    wrap.id = 'typing';
    const typing = document.createElement('div');
    typing.className = 'typing';
    typing.innerHTML = '<span class="b"></span><span class="b"></span><span class="b"></span>';
    wrap.appendChild(typing);
    chatBox.appendChild(wrap);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function hideTyping() {
    const t = document.getElementById('typing');
    if (t) t.remove();
  }

  async function sendMessage() {
    const msg = userInput.value.trim();
    if (!msg) return;

    displayMessage(msg, 'user');
    userInput.value = '';

    showTyping();

    try {
      const res = await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: msg })
      });

      hideTyping();

      if (!res.ok) {
        const text = await res.text();
        displayMessage('Error from backend: ' + text, 'bot');
        return;
      }

      const data = await res.json();

      // If backend returns plain text in `response`
      displayMessage(data.response ?? String(data), 'bot');
    } catch (e) {
      hideTyping();
      displayMessage('Could not reach backend: ' + e.message, 'bot');
    }
  }

  // Keyboard handlers: Enter to send, Shift+Enter for newline
  userInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  sendBtn.addEventListener('click', sendMessage);

  // Focus input on load for quick UX
  window.addEventListener('load', () => userInput.focus());
</script>
</body>
</html> 